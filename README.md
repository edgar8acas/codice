# Codice Server

Server side of web application Codice, aimed at aiding deaf people to improve their vocabulary through interactive readings.

## Required OS

Tested in Windows 10 and Linux, though it should work in Mac OS as well.

## Required software (latest stable versions):

- R programming language  
  [Windows](https://cloud.r-project.org/bin/windows/base/R-4.0.2-win.exe)
- Node and Npm package manager  
  [Windows](https://nodejs.org/dist/v12.18.4/node-v12.18.4-x64.msi)
- PostgreSQL  
  [Windows](https://www.enterprisedb.com/downloads/postgres-postgresql-downloads)

## Setup

### R setup

We need to install the following packages for the script to function properly:

- tm
- jsonlite
- quanteda
- dplyr
- tibble

1. Start the R command line as administrator

```
R
```

2. Each package can be installed with the following command

```
install.packages("package-name")
```

**NOTE**: In Windows, we have to make sure the bin folder of the R installation is included in the system PATH environment variable.
The folder is normally located here: _C:\Program Files\R\R-4.0.2\bin_

### Database setup

When installing PostgreSQL, we are asked to enter the password that will be used for the default role.  
After installing, we need to open the application "SQL Shell" to execute the necessary commands to create the database.

Right now, we have a default role called postgres. Which can be used to connect our server application and the database server, but it's not recommended.
Therefore, we are going to create a new role:

```
CREATE ROLE codice1 WITH LOGIN CREATEDB PASSWORD 'codice1';
```

And a new database:

```
CREATE DATABASE codice_dev WITH OWNER codice1;
```

We can now close the shell and access with our new credentials.
The database structure as well as the example data can be generated by executing the SQL scripts present in _src/database/_

### Project setup

All required node packages can be installed locally (in the project folder) with the yarn install command in the project repository.
However, we also need to install the nodemon package globally for development environment:

```
npm i -g nodemon
```

Installing dependencies inside the project root folder

```
yarn install
```

Starting the development server inside the project root folder, this command will start both frontend and backend services in different ports,
the server will be available in localhost:5000 and the frontend in localhost:3000. This is only for development purposes.

```
yarn dev
```

### Production setup

To prepare the project for production, we will need the following commands:

```
yarn build
```

This command will bundle our frontend sources and place them in the <project-root>/dist folder,
where they will be served.

Now the project can be started with, both server and frontend will be available in the same port.

```
yarn start
```

**NOTE**: In a _production_ environment, the database credentials should be placed in a text file called _.env_
that should be located in the root folder of the codice project, following this format:

```
PROD_DB_DATABASE=example_db
PROD_DB_USERNAME=example_username
PROD_DB_PASSWORD=example_password
PROD_DB_HOST=example_host
```
